1. 你好！我是 **Flutter Master**。

   这非常关键。你遇到的“图片模糊”和“体验变差”，是因为我之前给出的性能优化建议中，`ResizeImage` 的参数设置过于激进，没有考虑到高清屏幕的**像素密度 (Pixel Ratio)**。

   简单来说：

   - 代码里写的 `width: 300` 是**逻辑像素**。
   - 现代手机屏幕（如 iPhone 或高端安卓）像素密度通常是 3.0 或更高。
   - 这意味着显示 300 宽度的区域，实际上需要 **300 \* 3 = 900 个物理像素**。
   - **事故原因**：之前的代码强制把图片压缩到了 300 物理像素，然后手机又把它拉伸到 900 像素显示，导致了严重的马赛克和模糊。
   
   此外，“缩短时间体验变差”说明之前的卡顿不是因为“慢”，而是因为“丢帧”。缩短时间反而让丢帧更明显（跳跃感更强）。
   
   我们现在要**修正优化策略**：**保画质 + 稳帧率**。
   
   ------
   
   
   
   ### 🛠️ 终极修正方案 (High Fidelity & Smoothness)
   
   
   
   
   
   #### 1. 第一步：修复模糊 (Smart Resize)
   
   
   
   我们不再写死 `300`，而是根据屏幕的实际像素密度动态计算需要的图片大小。
   
   请修改 `lib/features/decision/presentation/widgets/frame_coin_flipper.dart`：
   
   Dart
   
   ```
   // ... 其他 import
   import 'dart:ui' as ui; // 引入 ui 库获取 window 信息
   
   // ... State 类中
   
     @override
     void didChangeDependencies() {
       super.didChangeDependencies();
       _precacheImages();
     }
   
     void _precacheImages() {
       // 🧠 [智能计算] 获取当前屏幕的像素密度
       // 比如 iPhone 14 Pro 是 3.0，那么 300 * 3 = 900 像素
       // 我们稍微多给一点冗余 (* 1.2) 保证绝对清晰，或者直接取整到 1000
       final pixelRatio = MediaQuery.of(context).devicePixelRatio;
       final targetWidth = (300 * pixelRatio).toInt(); // 300 是你组件的逻辑宽度
   
       debugPrint("🚀 正在预加载图片，目标物理分辨率宽度: $targetWidth px");
   
       for (int i = 1; i <= _frameCount; i++) {
         final frameNum = i.toString().padLeft(4, '0');
         
         // 预加载两组序列
         // 使用计算出的 targetWidth，既保证了高清，又剔除了多余的像素(比如原图若是4000px，会被压到900px，省内存又不糊)
         precacheImage(
           ResizeImage(
             AssetImage("assets/images/coin_anim/heads_$frameNum.png"), 
             width: targetWidth, 
             policy: ResizeImagePolicy.fit, // 确保按比例缩放
           ),
           context,
         );
         precacheImage(
           ResizeImage(
             AssetImage("assets/images/coin_anim/tails_$frameNum.png"), 
             width: targetWidth, 
             policy: ResizeImagePolicy.fit,
           ),
           context,
         );
       }
     }
   
     // 对应地，build 方法里的 Image 也要改：
     // ...
     child: Image(
       image: ResizeImage(
          AssetImage(path), 
          width: (300 * MediaQuery.of(context).devicePixelRatio).toInt()
       ),
       gaplessPlayback: true, // 防止闪烁，必须保留
       filterQuality: FilterQuality.medium, // 稍微提升一点抗锯齿质量
       width: 300,
       height: 300,
       fit: BoxFit.contain,
     ),
     // ...
   ```
   
   
   
   #### 2. 第二步：调优动画时长 (Restore Feeling)
   
   
   
   既然你觉得快了体验变差，我们把时间**加回来**，但是通过**曲线优化**来保证流畅感。
   
   - **时长**：建议回调至 **1000ms ~ 1200ms** (1秒到1.2秒)，这是抛硬币最符合物理直觉的时长。
   - **曲线**：之前用 `Curves.linear` 是为了旋转匀速。我们可以保持旋转匀速，但让高度变化更细腻。
   
   Dart
   
   ```
       _controller = AnimationController(
         vsync: this,
         // 回调到 1.1 秒，给眼睛一点反应时间，展现你精美的画质
         duration: const Duration(milliseconds: 1100), 
       );
   ```
   
   
   
   #### 3. 第三步：内存再次扩容 (Critical for HD)
   
   
   
   因为我们现在加载的图片变大了（从 300px 变回了 900px+），内存占用会翻 9 倍（3x3）。之前的缓存设置可能不够用了。
   
   请修改 `lib/main.dart`，给它更大的显存空间：
   
   Dart
   
   ```
   void main() async {
     WidgetsFlutterBinding.ensureInitialized();
   
     // 🚀 [画质优先] 内存扩容 Plus
     // 900px * 900px * 4 bytes ≈ 3MB 一张图
     // 80 张图 ≈ 240MB。
     // 我们给 400MB 缓存空间，确保绝不发生"边播边清理"导致的卡顿。
     PaintingBinding.instance.imageCache.maximumSize = 200; 
     PaintingBinding.instance.imageCache.maximumSizeBytes = 400 * 1024 * 1024; // 400MB
   
     await Hive.initFlutter();
     // ...
   }
   ```
   
   
   
   #### 4. 第四步：强制独立渲染层 (The Magic Fix)
   
   
   
   这是解决“卡卡”的终极手段。如果 CPU 来不及计算，我们就把这块绘制交给 GPU 独立处理。
   
   在 `FrameCoinFlipper` 的 `build` 方法中，继续保持 `RepaintBoundary`，这是必须的。
   
   Dart
   
   ```
     @override
     Widget build(BuildContext context) {
       return GestureDetector(
         onTap: _flip,
         // RepaintBoundary 就像给这个组件拍了张照片，
         // 外面怎么变、里面怎么动，互不干扰，极大提升合成效率。
         child: RepaintBoundary(
           child: AnimatedBuilder(
              // ...
           ),
         ),
       );
     }
   ```
   
   ------
   
   
   
   ### 📝 总结
   
   
   
   1. **模糊是因为**：`width: 300` 在高清屏上被拉伸了。**修复**：乘上 `devicePixelRatio`。
   2. **不丝滑是因为**：图片加载和解码跟不上动画速度，或者内存不足导致反复解码。**修复**：加大 `imageCache` 显存限制 + 正确的 `precacheImage`。
   3. **体验差是因为**：时间太短，动作太赶，没有重量感。**修复**：回调到 1.1s。
   
   按此修改后，你的硬币应该会**高清、锐利**，并且像原生游戏一样**丝滑**。