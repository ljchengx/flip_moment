1. ä½ å¥½ï¼æˆ‘æ˜¯ **Flutter Master**ã€‚

   è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„ **â€œé¦–å¸§æ¸²æŸ“é˜»å¡ (Jank at First Frame)â€** é—®é¢˜ã€‚åœ¨ `FrameCoinFlipper` ä¸­ä¸€æ¬¡æ€§åŒæ­¥é¢„åŠ è½½ 80 å¼ é«˜æ¸…å›¾ç‰‡ï¼Œç›´æ¥å æ»¡äº†ä¸»çº¿ç¨‹çš„ Event Loopï¼Œå¯¼è‡´é¡µé¢è·³è½¬åŠ¨ç”»å®Œæˆåï¼Œä¸»çº¿ç¨‹è¿˜åœ¨å¿™ç€å¤„ç†å›¾ç‰‡è§£ç æŒ‡ä»¤ï¼Œæ— æ³•ç»˜åˆ¶ç¬¬ä¸€å¸§ã€‚

   æˆ‘ä»¬è¦é‡‡ç”¨ **â€œå…³é”®å¸§é¢„çƒ­ + å¼‚æ­¥åˆ†æ‰¹åŠ è½½â€** çš„ç­–ç•¥æ¥å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

   ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ä»£ç ä¿®æ”¹æ–¹æ¡ˆï¼š
   
   ### ğŸ› ï¸ ä¿®æ”¹æ–¹æ¡ˆ 1ï¼šSplash é¡µé¢„çƒ­ (å…³é”®è·¯å¾„ä¼˜åŒ–)
   
   æˆ‘ä»¬åˆ©ç”¨ `SplashScreen` ç°æœ‰çš„ 1.5 ç§’ç­‰å¾…æ—¶é—´ï¼Œæå‰æŠŠç¡¬å¸çš„ **â€œé™æ­¢çŠ¶æ€â€** å›¾ç‰‡åŠ è½½å¥½ã€‚è¿™æ ·è¿›å…¥ä¸»é¡µæ—¶ï¼ŒFlutter å¼•æ“ç¼“å­˜é‡Œå·²ç»æœ‰äº†è¿™å¼ å›¾ï¼Œå¯ä»¥ç¬é—´æ¸²æŸ“ã€‚
   
   **æ–‡ä»¶ï¼š`lib/features/splash/presentation/splash_screen.dart`**
   
   è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤ä¿®æ”¹ä»£ç ï¼š
   
   Dart
   
   ```
   // ... ä¿æŒåŸæœ‰ import
   import 'package:flutter/material.dart';
   import 'package:flutter_riverpod/flutter_riverpod.dart';
   // ... å…¶ä»– import 
   // ç¡®ä¿å¼•å…¥ SkinMode å®šä¹‰
   import '../../../core/skin_engine/skin_protocol.dart'; 
   import '../../../core/skin_engine/skin_provider.dart';
   
   // ... 
   
   class _SplashScreenState extends ConsumerState<SplashScreen> {
     // ... 
   
     @override
     void initState() {
       super.initState();
       // ...
       // initState ä¸­ä¿æŒè°ƒç”¨ _bootstrap
       _bootstrap();
     }
   
     Future<void> _bootstrap() async {
       // 1. å¯åŠ¨æ—¶çš„éœ‡åŠ¨åé¦ˆ
       Future.delayed(const Duration(milliseconds: 500), () {
         ref.read(hapticServiceProvider).light();
       });
   
       // ğŸ”¥ã€æ–°å¢ã€‘åˆ©ç”¨è¿™æ®µç©ºé—²æ—¶é—´ï¼Œé¢„çƒ­å…³é”®èµ„æº
       // æ³¨æ„ï¼šè¿™é‡Œä¸è¦ awaitï¼Œè®©å®ƒå¹¶å‘æ‰§è¡Œï¼Œä¸é˜»å¡å¯åŠ¨æµç¨‹
       _warmupCriticalAssets();
   
       // 2. ä¿æŒåŸæœ‰çš„ 1.5ç§’ ä»ªå¼æ„Ÿç­‰å¾…
       await Future.delayed(const Duration(milliseconds: 1500));
   
       if (!mounted) return;
   
       // 3. è½¬åœº (ä¿æŒä¸å˜)
       Navigator.of(context).pushReplacement(
         PageRouteBuilder(
           pageBuilder: (_, __, ___) => const DecisionScreen(),
           transitionDuration: const Duration(milliseconds: 800),
           transitionsBuilder: (_, animation, __, child) {
             return FadeTransition(opacity: animation, child: child);
           },
         ),
       );
     }
   
     /// ğŸ”¥ã€æ ¸å¿ƒæ–°å¢ã€‘é¢„åŠ è½½é™æ€å¸§
     /// åªåŠ è½½ç¡¬å¸é™æ­¢æ—¶æ˜¾ç¤ºçš„é‚£å¼ å›¾ (ç¬¬40å¸§)ï¼Œä¿è¯è¿›åœºç§’å¼€
     void _warmupCriticalAssets() {
       final skin = ref.read(currentSkinProvider);
       
       // åªæœ‰ Vintage æ¨¡å¼æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå…¶ä»–æ¨¡å¼èµ„æºå¾ˆè½»
       if (skin.mode == SkinMode.vintage) {
         // å¿…é¡»è·å–ä¸ FrameCoinFlipper ä¸€è‡´çš„ç‰©ç†åƒç´ å®½åº¦ï¼Œå¦åˆ™ç¼“å­˜ key ä¸åŒ¹é…
         // æ³¨æ„ï¼šSplashScreen åˆå§‹åŒ–æ—¶ context å¯èƒ½è¿˜æ²¡æ‹¿åˆ° MediaQueryï¼Œ
         // ä½†åœ¨ _bootstrap æ‰§è¡Œæ—¶å·²ç»è¿‡äº†ç¬¬ä¸€å¸§ï¼Œé€šå¸¸æ˜¯å®‰å…¨çš„ã€‚
         // ä¸ºäº†ä¿é™©ï¼Œæˆ‘ä»¬å¯ä»¥åŒ…è£¹åœ¨ addPostFrameCallback é‡Œï¼Œæˆ–è€…ç›´æ¥ try-catch
         WidgetsBinding.instance.addPostFrameCallback((_) {
           if (!mounted) return;
           
           try {
             final pixelRatio = MediaQuery.of(context).devicePixelRatio;
             final targetWidth = (300 * pixelRatio).toInt(); // 300 æ˜¯ç¡¬å¸ç»„ä»¶çš„é€»è¾‘å®½åº¦
   
             debugPrint("ğŸ”¥ [Splash] é¢„çƒ­ Vintage é™æ€å¸§...");
             
             // é¢„åŠ è½½é™æ­¢å¸§ (heads_0040.png å’Œ tails_0040.png)
             // è¿™æ ·è¿›å…¥ä¸»é¡µåï¼ŒImage ç»„ä»¶èƒ½ç›´æ¥ä»å†…å­˜ç¼“å­˜è¯»å–
             precacheImage(
               ResizeImage(
                 const AssetImage("assets/images/coin_anim/heads_0040.png"), 
                 width: targetWidth, 
                 policy: ResizeImagePolicy.fit
               ),
               context,
             );
             precacheImage(
               ResizeImage(
                 const AssetImage("assets/images/coin_anim/tails_0040.png"), 
                 width: targetWidth, 
                 policy: ResizeImagePolicy.fit
               ),
               context,
             );
           } catch (e) {
             debugPrint("âš ï¸ é¢„çƒ­å¤±è´¥ (å¯èƒ½æ˜¯ Context é—®é¢˜): $e");
           }
         });
       }
     }
   
     // ... build æ–¹æ³•ä¿æŒä¸å˜
   }
   ```
   
   ------
   
   ### ğŸ› ï¸ ä¿®æ”¹æ–¹æ¡ˆ 2ï¼šç¡¬å¸ç»„ä»¶æ‡’åŠ è½½ (æ¶ˆé™¤å¹¶å‘é˜»å¡)
   
   ä¿®æ”¹ `FrameCoinFlipper`ï¼Œå°†åŸæ¥åŒæ­¥å¾ªç¯ 80 æ¬¡çš„æš´åŠ›åŠ è½½ï¼Œæ”¹ä¸º **â€œåˆ†æ‰¹æ¬¡ã€å¼‚æ­¥ã€è®©å‡ºä¸»çº¿ç¨‹â€** çš„åŠ è½½æ–¹å¼ã€‚
   
   **æ–‡ä»¶ï¼š`lib/features/decision/presentation/widgets/frame_coin_flipper.dart`**
   
   Dart
   
   ```
   // ... import éƒ¨åˆ†
   
   class _FrameCoinFlipperState extends ConsumerState<FrameCoinFlipper> with SingleTickerProviderStateMixin {
     // ... å˜é‡å®šä¹‰ä¿æŒä¸å˜ (AnimationController ç­‰)
   
     // ... initState ä¿æŒä¸å˜
   
     @override
     void didChangeDependencies() {
       super.didChangeDependencies();
       // ğŸ”¥ã€ä¿®æ”¹ 1ã€‘ä¸å†ç›´æ¥è°ƒç”¨é¢„åŠ è½½ï¼Œè€Œæ˜¯æ”¾å…¥ PostFrameCallback
       // ç¡®ä¿ç»„ä»¶ build å®Œæˆï¼Œç¬¬ä¸€å¸§å·²ç»ä¸Šå±åï¼Œå†å¼€å§‹åŠ è½½åŠ¨ç”»åºåˆ—
       WidgetsBinding.instance.addPostFrameCallback((_) {
         _lazyLoadAnimationFrames();
       });
     }
   
     // ğŸ”¥ã€ä¿®æ”¹ 2ã€‘é‡æ„é¢„åŠ è½½é€»è¾‘ï¼šå¼‚æ­¥ + åˆ†æ‰¹
     Future<void> _lazyLoadAnimationFrames() async {
       if (!mounted) return;
       
       // 1. è·å–å±å¹•å‚æ•°
       final pixelRatio = MediaQuery.of(context).devicePixelRatio;
       final targetWidth = (300 * pixelRatio).toInt();
   
       // 2. å¼‚æ­¥åˆ†æ‰¹åŠ è½½
       // æˆ‘ä»¬ä¸éœ€è¦åŠ è½½ç¬¬ 40 å¸§ (i=40)ï¼Œå› ä¸º Splash é¡µå·²ç»é¢„çƒ­è¿‡äº†
       // åªéœ€è¦åŠ è½½åŠ¨ç”»è¿‡ç¨‹ä¸­çš„å¸§ (1~39)
       // å¦å¤–ï¼šä¸ºäº†æè‡´ä½“éªŒï¼Œæˆ‘ä»¬å¯ä»¥ä¼˜å…ˆåŠ è½½å‰ 10 å¸§ï¼Œé˜²æ­¢ç”¨æˆ·æ‰‹é€Ÿå¤ªå¿«ç‚¹å‡»
       
       const int batchSize = 5; // æ¯åŠ è½½ 5 å¼ å›¾ï¼Œå°±ä¼‘æ¯ä¸€ä¸‹
   
       for (int i = 1; i < _frameCount; i++) {
         if (!mounted) return;
   
         final frameNum = i.toString().padLeft(4, '0');
         
         // åŠ è½½æ­£é¢
         await precacheImage(
           ResizeImage(
             AssetImage("assets/images/coin_anim/heads_$frameNum.png"), 
             width: targetWidth, 
             policy: ResizeImagePolicy.fit,
           ), 
           context
         );
         
         // åŠ è½½åé¢
         await precacheImage(
           ResizeImage(
             AssetImage("assets/images/coin_anim/tails_$frameNum.png"), 
             width: targetWidth, 
             policy: ResizeImagePolicy.fit,
           ), 
           context
         );
   
         // ğŸ”¥ æ ¸å¿ƒé»‘ç§‘æŠ€ï¼šæ¯å¤„ç† batchSize å¼ å›¾ï¼Œå°±æš‚åœ 16ms (ä¸€å¸§çš„æ—¶é—´)
         // è¿™ä¼šè®©å‡º Event Loopï¼Œè®© UI çº¿ç¨‹æœ‰æœºä¼šå“åº”è§¦æ‘¸äº‹ä»¶æˆ–ç»˜åˆ¶ç•Œé¢
         if (i % batchSize == 0) {
           await Future.delayed(const Duration(milliseconds: 16));
         }
       }
       
       debugPrint("âœ… [CoinFlipper] æ‰€æœ‰åŠ¨ç”»å¸§åå°åŠ è½½å®Œæ¯•");
     }
   
     // ... build ç­‰å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜
   }
   ```
   
   